import{r as l,a as G,s as d,j as e}from"./index-FRp6wVcD.js";import{S as R,T as V}from"./TopBar-DS7MBlT5.js";function ee(){const[b,k]=l.useState(!0),[v,U]=l.useState(!0),[u,j]=l.useState([]),[H,q]=l.useState(!0),{user:W,session:x}=G(),[y,E]=l.useState(null),[g,T]=l.useState(null),[J,K]=l.useState(""),[Q,X]=l.useState("todos"),[p,A]=l.useState(""),[N,D]=l.useState("todos"),[w,P]=l.useState("todos"),[$,m]=l.useState(!1),[c,C]=l.useState(null),[o,i]=l.useState({nome:"",email:"",senha:"",cargo:"tecnico",telefone:"",departamento:"",ativo:!0});l.useEffect(()=>{f(),(async()=>{var s;try{if(!((s=x==null?void 0:x.user)!=null&&s.email))return;const{data:r,error:a}=await d.from("usuarios").select("id, perfil").eq("email",x.user.email).limit(1).maybeSingle();if(a){console.debug("Não foi possível carregar perfil do usuário atual:",a.message||a);return}r&&(E(r.perfil||null),T(r.id||null))}catch(r){console.error("Erro ao obter perfil do usuário atual",r)}})()},[]);const f=()=>{(async()=>{q(!0);try{const{data:t,error:s}=await d.from("usuarios").select("*").order("nome",{ascending:!0});if(s)console.error("Erro ao carregar usuários do Supabase:",s),j([]);else if(t){const r=t.map(a=>({id:a.id,nome:a.nome,email:a.email,cargo:a.cargo||"",departamento:a.departamento||"",perfil:a.perfil||"visualizador",status:a.status||(a.ativo===!1?"inativo":"ativo"),telefone:a.telefone||"",dataAdmissao:a.data_admissao||a.created_at||"",ultimoAcesso:a.ultimo_acesso||a.last_sign_in_at||null,avatar:a.avatar||a.foto_url||void 0}));j(r)}}catch(t){console.error("Erro inesperado ao carregar usuários:",t),j([])}finally{q(!1)}})()},z=async t=>{t.preventDefault();try{if(c){const s={nome:o.nome,email:o.email,cargo:o.cargo,telefone:o.telefone,departamento:o.departamento,atualizado_em:new Date().toISOString()},{error:r}=await d.from("usuarios").update(s).eq("id",c.id);if(r)throw r}else{const s={nome:o.nome,email:o.email,senha:o.senha,cargo:o.cargo,telefone:o.telefone,departamento:o.departamento},{error:r}=await d.from("usuarios").insert([s]);if(r)throw r}m(!1),C(null),i({nome:"",email:"",senha:"",cargo:"tecnico",telefone:"",departamento:"",ativo:!0}),f()}catch(s){console.error("Erro ao salvar usuário:",s),alert("Erro ao salvar usuário. Tente novamente.")}},M=t=>{C(t),i({nome:t.nome,email:t.email,senha:"",cargo:t.cargo,telefone:t.telefone||"",departamento:t.departamento||"",ativo:t.ativo??!0}),m(!0)},B=async t=>{if(confirm("Tem certeza que deseja excluir este usuário?"))try{const{error:s}=await d.from("usuarios").delete().eq("id",t);if(s)throw s;f()}catch(s){console.error("Erro ao excluir usuário:",s),alert("Erro ao excluir usuário. Tente novamente.")}},L=async t=>{const s=t.status==="bloqueado"?"Deseja desbloquear este usuário?":"Deseja bloquear este usuário?";if(confirm(s))try{const r={};typeof t.ativo<"u"?r.ativo=!(!(""+t.ativo).startsWith("f")&&t.status!=="bloqueado"):r.status=t.status==="bloqueado"?"ativo":"bloqueado";const{error:a}=await d.from("usuarios").update(r).eq("id",t.id);if(a)throw a;f()}catch(r){console.error("Erro ao bloquear/desbloquear usuário:",r),alert("Erro ao bloquear/desbloquear usuário. Verifique se o banco tem a coluna `ativo` e se você tem permissão.")}},S=(t,s)=>y==="admin"||t==="edit"&&(g&&g===s.id||y==="gestor"&&s.perfil!=="admin")?!0:t==="delete"?!1:!!(t==="block"&&(y==="gestor"&&s.perfil==="tecnico"||g&&g===s.id)),_=u.filter(t=>{const s=t.nome.toLowerCase().includes(p.toLowerCase())||t.email.toLowerCase().includes(p.toLowerCase())||t.cargo.toLowerCase().includes(p.toLowerCase()),r=N==="todos"||t.status===N,a=w==="todos"||t.perfil===w;return s&&r&&a}),F=t=>{const s={admin:{bg:"bg-red-500/10",text:"text-red-400",badge:"bg-red-500",nome:"Administrador"},gestor:{bg:"bg-purple-500/10",text:"text-purple-400",badge:"bg-purple-500",nome:"Gestor"},tecnico:{bg:"bg-blue-500/10",text:"text-blue-400",badge:"bg-blue-500",nome:"Técnico"},visualizador:{bg:"bg-gray-500/10",text:"text-gray-400",badge:"bg-gray-500",nome:"Visualizador"}};return s[t]||s.visualizador},I=t=>{const s={ativo:{bg:"bg-green-500/10",text:"text-green-400",badge:"bg-green-500",nome:"Ativo"},inativo:{bg:"bg-yellow-500/10",text:"text-yellow-400",badge:"bg-yellow-500",nome:"Inativo"},bloqueado:{bg:"bg-red-500/10",text:"text-red-400",badge:"bg-red-500",nome:"Bloqueado"}};return s[t]||s.inativo},O=t=>{if(!t)return"Nunca";const s=new Date,r=new Date(t),a=s.getTime()-r.getTime(),n=Math.floor(a/864e5);return n===0?"Hoje":n===1?"Ontem":n<7?`${n} dias atrás`:n<30?`${Math.floor(n/7)} semanas atrás`:`${Math.floor(n/30)} meses atrás`},h={total:u.length,ativos:u.filter(t=>t.status==="ativo").length,inativos:u.filter(t=>t.status==="inativo").length,bloqueados:u.filter(t=>t.status==="bloqueado").length};return e.jsxs("div",{className:`min-h-screen ${v?"bg-slate-900":"bg-gray-100"} transition-colors duration-300`,children:[e.jsx(R,{isOpen:b,onToggle:()=>k(!b),darkMode:v}),e.jsxs("div",{className:`transition-all duration-300 ${b?"ml-64":"ml-20"}`,children:[e.jsx(V,{darkMode:v,setDarkMode:U}),e.jsxs("main",{className:"p-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-violet-600 to-purple-600 rounded-xl p-6 mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"Gestão de Usuários"}),e.jsx("p",{className:"text-violet-100",children:"Controle de acesso e permissões do sistema"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-600 to-blue-700 rounded-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("i",{className:"ri-user-line text-3xl opacity-80"}),e.jsx("span",{className:"text-4xl font-bold",children:h.total})]}),e.jsx("h3",{className:"text-sm font-medium opacity-90",children:"Total de Usuários"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-600 to-green-700 rounded-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("i",{className:"ri-user-smile-line text-3xl opacity-80"}),e.jsx("span",{className:"text-4xl font-bold",children:h.ativos})]}),e.jsx("h3",{className:"text-sm font-medium opacity-90",children:"Usuários Ativos"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-yellow-600 to-yellow-700 rounded-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("i",{className:"ri-user-unfollow-line text-3xl opacity-80"}),e.jsx("span",{className:"text-4xl font-bold",children:h.inativos})]}),e.jsx("h3",{className:"text-sm font-medium opacity-90",children:"Usuários Inativos"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-red-600 to-red-700 rounded-lg p-6 text-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("i",{className:"ri-user-forbid-line text-3xl opacity-80"}),e.jsx("span",{className:"text-4xl font-bold",children:h.bloqueados})]}),e.jsx("h3",{className:"text-sm font-medium opacity-90",children:"Usuários Bloqueados"})]})]}),e.jsx("div",{className:"bg-gray-900 rounded-lg border border-gray-800 p-4 mb-6",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[300px]",children:e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"ri-search-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por nome, email ou cargo...",value:p,onChange:t=>A(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-500 focus:outline-none focus:border-violet-500"})]})}),e.jsxs("select",{value:N,onChange:t=>D(t.target.value),className:"px-4 py-2 pr-8 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-violet-500",children:[e.jsx("option",{value:"todos",children:"Todos os Status"}),e.jsx("option",{value:"ativo",children:"Ativos"}),e.jsx("option",{value:"inativo",children:"Inativos"}),e.jsx("option",{value:"bloqueado",children:"Bloqueados"})]}),e.jsxs("select",{value:w,onChange:t=>P(t.target.value),className:"px-4 py-2 pr-8 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-violet-500",children:[e.jsx("option",{value:"todos",children:"Todos os Perfis"}),e.jsx("option",{value:"admin",children:"Administrador"}),e.jsx("option",{value:"gestor",children:"Gestor"}),e.jsx("option",{value:"tecnico",children:"Técnico"}),e.jsx("option",{value:"visualizador",children:"Visualizador"})]}),e.jsxs("button",{onClick:()=>{C(null),i({nome:"",email:"",senha:"",cargo:"tecnico",telefone:"",departamento:"",ativo:!0}),m(!0)},className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-user-add-line mr-2"}),"Novo Usuário"]})]})}),$&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-slate-800 rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:c?"Editar Usuário":"Novo Usuário"}),e.jsx("button",{onClick:()=>m(!1),className:"w-10 h-10 rounded-lg flex items-center justify-center cursor-pointer hover:bg-slate-700",children:e.jsx("i",{className:"ri-close-line text-xl text-gray-400"})})]}),e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Nome Completo *"}),e.jsx("input",{type:"text",value:o.nome,onChange:t=>i({...o,nome:t.target.value}),className:"w-full px-4 py-2 rounded-lg border bg-slate-700 border-slate-600 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"E-mail *"}),e.jsx("input",{type:"email",value:o.email,onChange:t=>i({...o,email:t.target.value}),className:"w-full px-4 py-2 rounded-lg border bg-slate-700 border-slate-600 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),!c&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Senha *"}),e.jsx("input",{type:"password",value:o.senha,onChange:t=>i({...o,senha:t.target.value}),className:"w-full px-4 py-2 rounded-lg border bg-slate-700 border-slate-600 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!c,minLength:6})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Cargo *"}),e.jsxs("select",{value:o.cargo,onChange:t=>i({...o,cargo:t.target.value}),className:"w-full px-4 py-2 pr-8 rounded-lg border bg-slate-700 border-slate-600 text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"admin",children:"Administrador"}),e.jsx("option",{value:"gestor",children:"Gestor"}),e.jsx("option",{value:"tecnico",children:"Técnico"}),e.jsx("option",{value:"operador",children:"Operador"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Telefone"}),e.jsx("input",{type:"tel",value:o.telefone,onChange:t=>i({...o,telefone:t.target.value}),className:"w-full px-4 py-2 rounded-lg border bg-slate-700 border-slate-600 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-300",children:"Departamento"}),e.jsx("input",{type:"text",value:o.departamento,onChange:t=>i({...o,departamento:t.target.value}),className:"w-full px-4 py-2 rounded-lg border bg-slate-700 border-slate-600 text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",id:"ativo",checked:o.ativo,onChange:t=>i({...o,ativo:t.target.checked}),className:"w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("label",{htmlFor:"ativo",className:"text-sm text-gray-300",children:"Usuário ativo"})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"flex-1 px-6 py-3 rounded-lg border border-slate-600 text-gray-300 hover:bg-slate-700 cursor-pointer whitespace-nowrap",children:"Cancelar"}),e.jsxs("button",{type:"submit",className:"flex-1 px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-lg hover:from-blue-700 hover:to-purple-700 cursor-pointer whitespace-nowrap",children:[c?"Atualizar":"Criar"," Usuário"]})]})]})]})}),e.jsx("div",{className:"bg-gray-900 rounded-lg border border-gray-800 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-800 border-b border-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Usuário"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Cargo / Departamento"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Perfil"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Último Acesso"}),e.jsx("th",{className:"px-6 py-4 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Ações"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-800",children:_.map(t=>{const s=F(t.perfil),r=I(t.status);return e.jsxs("tr",{className:"hover:bg-gray-800/50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-violet-500 to-purple-500 flex items-center justify-center text-white font-bold",children:t.nome.split(" ").map(a=>a[0]).join("").substring(0,2)}),e.jsxs("div",{children:[e.jsx("div",{className:"text-white font-medium",children:t.nome}),e.jsx("div",{className:"text-sm text-gray-400",children:t.email})]})]})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("div",{className:"text-white",children:t.cargo}),e.jsx("div",{className:"text-sm text-gray-400",children:t.departamento})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-medium ${s.bg} ${s.text}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${s.badge}`}),s.nome]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("span",{className:`inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-medium ${r.bg} ${r.text}`,children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${r.badge}`}),r.nome]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-400",children:O(t.ultimoAcesso)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[S("edit",t)?e.jsx("button",{onClick:()=>M(t),className:"p-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition-all cursor-pointer",title:"Editar",children:e.jsx("i",{className:"ri-edit-line"})}):e.jsx("span",{className:"p-2 text-gray-600 opacity-60 rounded-lg",children:" "}),S("block",t)?e.jsx("button",{onClick:()=>L(t),className:"p-2 text-gray-400 hover:text-white hover:bg-gray-800 rounded-lg transition-all cursor-pointer",title:t.status==="bloqueado"?"Desbloquear":"Bloquear",children:e.jsx("i",{className:"ri-key-line"})}):e.jsx("span",{className:"p-2 text-gray-600 opacity-60 rounded-lg",children:" "}),S("delete",t)?e.jsx("button",{onClick:()=>B(t.id),className:"p-2 text-gray-400 hover:text-red-400 hover:bg-gray-800 rounded-lg transition-all cursor-pointer",title:"Excluir",children:e.jsx("i",{className:"ri-delete-bin-line"})}):e.jsx("span",{className:"p-2 text-gray-600 opacity-60 rounded-lg",children:" "})]})})]},t.id)})})]})})})]})]})]})}export{ee as default};
//# sourceMappingURL=page-CTcHshIh.js.map
