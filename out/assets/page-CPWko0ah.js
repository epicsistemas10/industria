import{r as n,s as K,j as e}from"./index-FRp6wVcD.js";import{S as O,T as I}from"./TopBar-DS7MBlT5.js";import{c as y}from"./api-DesrtcF2.js";import{u as G}from"./usePermissions-YeN8SHyT.js";function V({isOpen:u,onClose:b,onSuccess:s,componenteId:i,darkMode:o=!0}){const[g,x]=n.useState(!1),[j,m]=n.useState([]),[a,l]=n.useState({nome:"",codigo_interno:"",codigo_fabricante:"",marca:"",tipo_componente_id:"",especificacoes:"",estoque_minimo:0,preco_unitario:0,foto_url:""});n.useEffect(()=>{u&&(w(),i?p():N())},[u,i]);const w=async()=>{try{const{data:r,error:c}=await K.from("tipos_componentes").select("*").order("nome");if(c)throw c;m(r||[])}catch(r){console.error("Erro ao carregar tipos de componentes:",r)}},p=async()=>{if(i)try{x(!0);const r=await y.getById(i);l({nome:r.nome||"",codigo_interno:r.codigo_interno||"",codigo_fabricante:r.codigo_fabricante||"",marca:r.marca||"",tipo_componente_id:r.tipo_componente_id||"",especificacoes:r.especificacoes||"",estoque_minimo:r.estoque_minimo||0,preco_unitario:r.preco_unitario||0,foto_url:r.foto_url||""})}catch(r){console.error("Erro ao carregar componente:",r)}finally{x(!1)}},N=()=>{l({nome:"",codigo_interno:"",codigo_fabricante:"",marca:"",tipo_componente_id:"",especificacoes:"",estoque_minimo:0,preco_unitario:0,foto_url:""})},v=async r=>{r.preventDefault();try{x(!0),i?await y.update(i,a):await y.create(a),s(),b()}catch(c){console.error("Erro ao salvar componente:",c),alert("Erro ao salvar componente. Tente novamente.")}finally{x(!1)}},_=r=>{var h;const c=(h=r.target.files)==null?void 0:h[0];if(c){const f=new FileReader;f.onloadend=()=>{l({...a,foto_url:f.result})},f.readAsDataURL(c)}};return u?e.jsx("div",{className:"fixed inset-0 bg-black/80 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`${o?"bg-slate-800":"bg-white"} rounded-xl max-w-3xl w-full max-h-[90vh] overflow-y-auto`,children:[e.jsxs("div",{className:"sticky top-0 bg-gradient-to-r from-purple-600 to-pink-600 p-6 flex justify-between items-center rounded-t-xl",children:[e.jsxs("h2",{className:"text-2xl font-bold text-white",children:[e.jsx("i",{className:"ri-settings-4-line mr-2"}),i?"Editar Componente":"Novo Componente"]}),e.jsx("button",{onClick:b,className:"text-white hover:text-gray-200 transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-close-line text-2xl"})})]}),e.jsxs("form",{onSubmit:v,className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${o?"text-gray-300":"text-gray-700"}`,children:"Nome do Componente *"}),e.jsx("input",{type:"text",required:!0,value:a.nome,onChange:r=>l({...a,nome:r.target.value}),className:`w-full px-4 py-2 rounded-lg border ${o?"bg-slate-700 border-slate-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:border-purple-500`,placeholder:"Ex: Rolamento SKF 6205"})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${o?"text-gray-300":"text-gray-700"}`,children:"Código Interno *"}),e.jsx("input",{type:"text",required:!0,value:a.codigo_interno,onChange:r=>l({...a,codigo_interno:r.target.value}),className:`w-full px-4 py-2 rounded-lg border ${o?"bg-slate-700 border-slate-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:border-purple-500`,placeholder:"Ex: COMP-001"})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${o?"text-gray-300":"text-gray-700"}`,children:"Código do Fabricante"}),e.jsx("input",{type:"text",value:a.codigo_fabricante,onChange:r=>l({...a,codigo_fabricante:r.target.value}),className:`w-full px-4 py-2 rounded-lg border ${o?"bg-slate-700 border-slate-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:border-purple-500`,placeholder:"Ex: SKF-6205-2RS"})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${o?"text-gray-300":"text-gray-700"}`,children:"Marca"}),e.jsx("input",{type:"text",value:a.marca,onChange:r=>l({...a,marca:r.target.value}),className:`w-full px-4 py-2 rounded-lg border ${o?"bg-slate-700 border-slate-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:border-purple-500`,placeholder:"Ex: SKF"})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${o?"text-gray-300":"text-gray-700"}`,children:"Tipo de Componente *"}),e.jsxs("select",{required:!0,value:a.tipo_componente_id,onChange:r=>l({...a,tipo_componente_id:r.target.value}),className:`w-full px-4 py-2 rounded-lg border cursor-pointer ${o?"bg-slate-700 border-slate-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:border-purple-500 pr-8`,children:[e.jsx("option",{value:"",children:"Selecione o tipo"}),j.map(r=>e.jsx("option",{value:r.id,children:r.nome},r.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${o?"text-gray-300":"text-gray-700"}`,children:"Estoque Mínimo"}),e.jsx("input",{type:"number",min:"0",value:a.estoque_minimo,onChange:r=>l({...a,estoque_minimo:parseInt(r.target.value)||0}),className:`w-full px-4 py-2 rounded-lg border ${o?"bg-slate-700 border-slate-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:border-purple-500`})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${o?"text-gray-300":"text-gray-700"}`,children:"Preço Unitário (R$)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:a.preco_unitario,onChange:r=>l({...a,preco_unitario:parseFloat(r.target.value)||0}),className:`w-full px-4 py-2 rounded-lg border ${o?"bg-slate-700 border-slate-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:border-purple-500`,placeholder:"0.00"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${o?"text-gray-300":"text-gray-700"}`,children:"Especificações"}),e.jsx("textarea",{rows:3,value:a.especificacoes,onChange:r=>l({...a,especificacoes:r.target.value}),className:`w-full px-4 py-2 rounded-lg border ${o?"bg-slate-700 border-slate-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:outline-none focus:border-purple-500`,placeholder:"Dimensões, material, características técnicas...",maxLength:500})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${o?"text-gray-300":"text-gray-700"}`,children:"Foto do Componente"}),e.jsxs("div",{className:"flex items-center gap-4",children:[a.foto_url&&e.jsx("img",{src:a.foto_url,alt:"Preview",className:"w-20 h-20 rounded-lg object-cover"}),e.jsxs("label",{className:"px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 cursor-pointer whitespace-nowrap",children:[e.jsx("i",{className:"ri-upload-2-line mr-2"}),a.foto_url?"Alterar Foto":"Fazer Upload",e.jsx("input",{type:"file",accept:"image/*",onChange:_,className:"hidden"})]}),a.foto_url&&e.jsx("button",{type:"button",onClick:()=>l({...a,foto_url:""}),className:"px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 cursor-pointer whitespace-nowrap",children:e.jsx("i",{className:"ri-delete-bin-line"})})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:b,disabled:g,className:`flex-1 px-6 py-3 rounded-lg transition-colors whitespace-nowrap cursor-pointer ${o?"bg-slate-700 text-white hover:bg-slate-600":"bg-gray-200 text-gray-900 hover:bg-gray-300"}`,children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:g,className:"flex-1 px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all whitespace-nowrap cursor-pointer disabled:opacity-50",children:g?"Salvando...":i?"Atualizar":"Criar"})]})]})]})}):null}function X(){const[u,b]=n.useState(!0),[s,i]=n.useState(!0),[o,g]=n.useState([]),[x,j]=n.useState(!0),[m,a]=n.useState(""),[l,w]=n.useState(""),[p,N]=n.useState(""),{canCreate:v,canEdit:_,canDelete:r}=G(),[c,h]=n.useState(!1),[f,C]=n.useState();n.useEffect(()=>{s?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[s]),n.useEffect(()=>{$()},[]);const $=async()=>{try{j(!0);const t=await y.getAll();g(t||[])}catch(t){console.error("Erro ao carregar componentes:",t),g([])}finally{j(!1)}},L=async t=>{if(!r){alert("Você não tem permissão para excluir componentes");return}if(confirm("Tem certeza que deseja excluir este componente?"))try{await y.delete(t),$()}catch(d){console.error("Erro ao excluir componente:",d),alert("Erro ao excluir componente")}},D=t=>{C(t),h(!0)},E=()=>{C(void 0),h(!0)},P=()=>{h(!1),C(void 0)},R=()=>{$()},S=o.filter(t=>{var k,T,F,q;const d=(((k=t.nome)==null?void 0:k.toLowerCase())||"").includes(m.toLowerCase())||(((T=t.codigo_interno)==null?void 0:T.toLowerCase())||"").includes(m.toLowerCase())||(((F=t.codigo_fabricante)==null?void 0:F.toLowerCase())||"").includes(m.toLowerCase()),U=!l||t.tipo===l||((q=t.tipos_componentes)==null?void 0:q.nome)===l,z=!p||t.marca===p;return d&&U&&z}),A=[...new Set(o.map(t=>{var d;return((d=t.tipos_componentes)==null?void 0:d.nome)||t.tipo}).filter(Boolean))],B=[...new Set(o.map(t=>t.marca).filter(Boolean))];return e.jsxs("div",{className:`min-h-screen ${s?"bg-slate-900":"bg-gray-100"} transition-colors duration-300`,children:[e.jsx(O,{isOpen:u,onToggle:()=>b(!u),darkMode:s}),e.jsxs("div",{className:`transition-all duration-300 ${u?"ml-64":"ml-20"}`,children:[e.jsx(I,{darkMode:s,setDarkMode:i}),e.jsxs("main",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:`text-3xl font-bold ${s?"text-white":"text-gray-900"}`,children:[e.jsx("i",{className:"ri-settings-3-line mr-3"}),"Componentes"]}),e.jsx("p",{className:`mt-1 ${s?"text-gray-400":"text-gray-600"}`,children:"Gerencie peças e componentes do estoque"})]}),e.jsxs("button",{onClick:E,className:"px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all shadow-lg whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-add-line mr-2"}),"Novo Componente"]})]}),e.jsx("div",{className:`${s?"bg-slate-800":"bg-white"} rounded-xl p-4 mb-6 shadow-lg`,children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:`ri-search-line absolute left-3 top-1/2 -translate-y-1/2 ${s?"text-gray-400":"text-gray-500"}`}),e.jsx("input",{type:"text",placeholder:"Buscar por nome ou código...",value:m,onChange:t=>a(t.target.value),className:`w-full pl-10 pr-4 py-2 rounded-lg border ${s?"bg-slate-700 border-slate-600 text-white placeholder-gray-400":"bg-white border-gray-300 text-gray-900"} focus:ring-2 focus:ring-blue-500 focus:border-transparent`})]}),e.jsxs("select",{value:l,onChange:t=>w(t.target.value),className:`px-4 py-2 rounded-lg border ${s?"bg-slate-700 border-slate-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:ring-2 focus:ring-blue-500 focus:border-transparent`,children:[e.jsx("option",{value:"",children:"Todos os Tipos"}),A.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:p,onChange:t=>N(t.target.value),className:`px-4 py-2 rounded-lg border ${s?"bg-slate-700 border-slate-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:ring-2 focus:ring-blue-500 focus:border-transparent`,children:[e.jsx("option",{value:"",children:"Todas as Marcas"}),B.map(t=>e.jsx("option",{value:t,children:t},t))]})]})}),x&&e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})}),!x&&S.length>0&&e.jsx("div",{className:`rounded-xl shadow-lg border overflow-hidden ${s?"bg-slate-800 border-slate-700":"bg-white border-gray-200"}`,children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:`border-b ${s?"bg-slate-700/50 border-slate-600":"bg-gray-50 border-gray-200"}`,children:e.jsxs("tr",{children:[e.jsx("th",{className:`px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider ${s?"text-gray-300":"text-gray-600"}`,children:"Componente"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider ${s?"text-gray-300":"text-gray-600"}`,children:"Código Interno"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider ${s?"text-gray-300":"text-gray-600"}`,children:"Código Fabricante"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider ${s?"text-gray-300":"text-gray-600"}`,children:"Marca"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider ${s?"text-gray-300":"text-gray-600"}`,children:"Tipo"}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider ${s?"text-gray-300":"text-gray-600"}`,children:"Estoque Mín."}),e.jsx("th",{className:`px-6 py-3 text-left text-xs font-semibold uppercase tracking-wider ${s?"text-gray-300":"text-gray-600"}`,children:"Preço Unit."}),e.jsx("th",{className:`px-6 py-3 text-right text-xs font-semibold uppercase tracking-wider ${s?"text-gray-300":"text-gray-600"}`,children:"Ações"})]})}),e.jsx("tbody",{className:`divide-y ${s?"divide-slate-700":"divide-gray-200"}`,children:S.map(t=>{var d;return e.jsxs("tr",{className:s?"hover:bg-slate-700/50":"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[t.foto_url?e.jsx("img",{src:t.foto_url,alt:t.nome,className:"w-10 h-10 rounded-lg object-cover"}):e.jsx("div",{className:`w-10 h-10 rounded-lg flex items-center justify-center ${s?"bg-blue-900/50":"bg-blue-100"}`,children:e.jsx("i",{className:`ri-tools-fill ${s?"text-blue-400":"text-blue-600"}`})}),e.jsx("span",{className:`font-medium ${s?"text-white":"text-gray-900"}`,children:t.nome})]})}),e.jsx("td",{className:`px-6 py-4 text-sm ${s?"text-gray-400":"text-gray-600"}`,children:t.codigo_interno||"-"}),e.jsx("td",{className:`px-6 py-4 text-sm ${s?"text-gray-400":"text-gray-600"}`,children:t.codigo_fabricante||"-"}),e.jsx("td",{className:`px-6 py-4 text-sm ${s?"text-gray-400":"text-gray-600"}`,children:t.marca||"-"}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${s?"bg-blue-900/50 text-blue-400":"bg-blue-100 text-blue-800"}`,children:((d=t.tipos_componentes)==null?void 0:d.nome)||t.tipo||"-"})}),e.jsx("td",{className:`px-6 py-4 text-sm ${s?"text-gray-400":"text-gray-600"}`,children:t.estoque_minimo||0}),e.jsx("td",{className:`px-6 py-4 text-sm font-medium ${s?"text-white":"text-gray-900"}`,children:t.preco_unitario?`R$ ${t.preco_unitario.toFixed(2)}`:"-"}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex gap-2 justify-end",children:[_&&e.jsx("button",{onClick:()=>D(t.id),className:"w-8 h-8 flex items-center justify-center bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-edit-line"})}),r&&e.jsx("button",{onClick:()=>L(t.id),className:"w-8 h-8 flex items-center justify-center bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors cursor-pointer",children:e.jsx("i",{className:"ri-delete-bin-line"})})]})})]},t.id)})})]})})}),!x&&S.length===0&&e.jsxs("div",{className:`${s?"bg-slate-800":"bg-white"} rounded-xl p-12 text-center shadow-lg`,children:[e.jsx("i",{className:`ri-box-3-line text-6xl mb-4 ${s?"text-gray-600":"text-gray-300"}`}),e.jsx("h3",{className:`text-xl font-semibold mb-2 ${s?"text-white":"text-gray-900"}`,children:"Nenhum componente encontrado"}),e.jsx("p",{className:`mb-6 ${s?"text-gray-400":"text-gray-600"}`,children:m||l||p?"Tente ajustar os filtros de busca":"Comece cadastrando um novo componente"}),v&&!m&&!l&&!p&&e.jsxs("button",{onClick:E,className:"bg-gradient-to-r from-purple-600 to-pink-600 text-white px-6 py-3 rounded-lg hover:shadow-lg transition-all whitespace-nowrap cursor-pointer",children:[e.jsx("i",{className:"ri-add-line mr-2"}),"Cadastrar Primeiro Componente"]})]})]})]}),e.jsx(V,{isOpen:c,onClose:P,onSuccess:R,componenteId:f,darkMode:s})]})}export{X as default};
//# sourceMappingURL=page-CPWko0ah.js.map
