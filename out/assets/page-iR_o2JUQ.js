import{r as i,s as m,j as e}from"./index-FRp6wVcD.js";function B(){const[l,b]=i.useState({equipamentosOperacionais:0,equipamentosManutencao:0,equipamentosParados:0,equipamentosAlerta:0,osAbertas:0,osEmAndamento:0,osConcluidas:0,totalEquipamentos:0}),[V,k]=i.useState(""),[x,p]=i.useState(""),[f,g]=i.useState([]),[j,S]=i.useState([]),[y,_]=i.useState([]),[P,E]=i.useState([]),[N,v]=i.useState(new Date),[R,F]=i.useState("mapa"),[w,I]=i.useState(null),[M,D]=i.useState("");i.useEffect(()=>{q();const a=localStorage.getItem("company_logo"),r=localStorage.getItem("company_name");a&&I(a),r&&D(r),console.log("ðŸ” Tentando carregar mapa do localStorage...");const o=localStorage.getItem("map_image");console.log("ðŸ“¦ Valor encontrado no localStorage:",o?"Imagem encontrada":"Nenhuma imagem"),o?(console.log("âœ… Mapa carregado com sucesso!"),console.log("ðŸ“ Tamanho da imagem:",o.length,"caracteres"),p(o)):(console.log("âš ï¸ Nenhum mapa encontrado no localStorage"),console.log('ðŸ’¡ Dica: FaÃ§a upload do mapa em "Mapa Industrial" primeiro'));const t=setInterval(()=>{q(),v(new Date);const n=localStorage.getItem("map_image");n&&n!==x&&(console.log("ðŸ”„ Mapa atualizado detectado"),p(n))},3e4),s=setInterval(()=>{v(new Date)},1e3);return()=>{clearInterval(t),clearInterval(s)}},[]),i.useEffect(()=>{T(),C()},[]);const T=async()=>{try{const{data:a,error:r}=await m.from("equipamentos").select("*, setores(nome)");if(!r&&a){const o=a.map(t=>{var s;return{id:t.id,nome:t.nome||"Sem nome",status:t.status||"parado",progresso:t.status_revisao||0,setor:((s=t.setores)==null?void 0:s.nome)||"Sem setor",criticidade:t.criticidade,imagem_url:t.imagem_url}});g(o)}else g([])}catch(a){console.error("Erro ao carregar equipamentos (TV):",a),g([])}},C=async()=>{try{const{data:a,error:r}=await m.from("equipamento_mapa").select("*");if(!r&&a){const o=a.map(t=>({id:t.id,equipamento_id:t.equipamento_id,x:t.x||10,y:t.y||10,width:t.width||8,height:t.height||8,color:t.color||"#10b981",fontSize:t.font_size||14,icon:t.icon||"ri-tools-fill"}));S(o)}}catch(a){console.error("Erro ao carregar hotspots (TV):",a)}},A=a=>{switch(a){case"operacional":return"#10b981";case"manutencao":return"#f59e0b";case"parado":return"#ef4444";case"alerta":return"#eab308";default:return"#6b7280"}},q=async()=>{try{const{data:a}=await m.from("equipamentos").select("status, criticidade, imagem_url");if(a){const s=a.length,n=a.filter(d=>d.status==="operacional").length,u=a.filter(d=>d.status==="manutencao").length,h=a.filter(d=>d.status==="parado").length,c=a.filter(d=>d.status==="alerta").length;b(d=>({...d,totalEquipamentos:s,equipamentosOperacionais:n,equipamentosManutencao:u,equipamentosParados:h,equipamentosAlerta:c}))}const{data:r}=await m.from("ordens_servico").select("status, data_abertura");if(r){const s=new Date;s.setHours(0,0,0,0);const n=r.filter(c=>c.status==="aberta").length,u=r.filter(c=>c.status==="em_andamento").length,h=r.filter(c=>c.status!=="concluida"?!1:new Date(c.data_abertura)>=s).length;b(c=>({...c,osAbertas:n,osEmAndamento:u,osConcluidas:h}))}const{data:o}=await m.from("planejamento_semana").select("*, equipamentos(nome)").eq("semana",0).order("data_inicio");o&&_(o.map(s=>{var n;return{id:s.id,equipamento_nome:((n=s.equipamentos)==null?void 0:n.nome)||"Sem equipamento",tipo:s.tipo,descricao:s.descricao,data_inicio:s.data_inicio,responsavel:s.responsavel,prioridade:s.prioridade}}));const{data:t}=await m.from("equipes").select("*").eq("disponibilidade",!0);t&&E(t.map(s=>({id:s.id,nome:s.nome,turno:s.turno||"Integral",membros:s.membros||[],equipamentos:[]})))}catch(a){console.error("Erro ao carregar dados:",a)}},$=a=>{switch(a){case"alta":return"bg-red-500";case"media":return"bg-yellow-500";case"baixa":return"bg-green-500";default:return"bg-gray-500"}},z=a=>{switch(a){case"revisao":return"ri-tools-line";case"manutencao":return"ri-hammer-line";case"inspecao":return"ri-search-eye-line";case"limpeza":return"ri-brush-line";default:return"ri-file-list-line"}},O=["Segunda","TerÃ§a","Quarta","Quinta","Sexta","SÃ¡bado"];l.totalEquipamentos>0&&(l.equipamentosOperacionais/l.totalEquipamentos*100).toFixed(1);const L=l.totalEquipamentos>0?((l.equipamentosOperacionais+l.equipamentosManutencao)/l.totalEquipamentos*100).toFixed(1):"0.0";return e.jsxs("div",{className:"min-h-screen w-full bg-gradient-to-br from-slate-900 via-blue-900 to-purple-900 p-4 md:p-6 lg:p-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[w?e.jsx("img",{src:w,alt:"Logo",className:"w-16 h-16 rounded-lg object-contain bg-white/10 p-2"}):e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center",children:e.jsx("i",{className:"ri-plant-line text-white text-3xl"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Dashboard ManutenÃ§Ã£o"}),e.jsx("p",{className:"text-blue-200 text-base font-bold",children:M})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-3xl font-bold text-white",children:N.toLocaleTimeString("pt-BR")}),e.jsx("div",{className:"text-blue-200 text-base",children:N.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})})]})]}),e.jsx("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-4 border border-white/20 mb-4",children:e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-4xl font-bold text-green-400 mb-1",children:[L,"%"]}),e.jsx("div",{className:"text-green-200 text-sm",children:"MÃ©dia de RevisÃ£o"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl font-bold text-blue-400 mb-1",children:l.equipamentosOperacionais}),e.jsx("div",{className:"text-blue-200 text-sm",children:"Operacionais"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl font-bold text-orange-400 mb-1",children:l.equipamentosManutencao}),e.jsx("div",{className:"text-orange-200 text-sm",children:"Em ManutenÃ§Ã£o"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-4xl font-bold text-purple-400 mb-1",children:l.totalEquipamentos}),e.jsx("div",{className:"text-purple-200 text-sm",children:"Total"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-4 border border-white/20",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-3 flex items-center gap-2",children:[e.jsx("i",{className:"ri-map-pin-line text-blue-400"}),"Mapa Industrial"]}),x?e.jsxs("div",{className:"relative w-full h-[400px] lg:h-[500px] rounded-lg overflow-hidden bg-slate-800/50",children:[e.jsx("img",{src:x,alt:"Mapa Industrial",className:"w-full h-full object-cover pointer-events-none",onError:a=>{console.error("âŒ Erro ao carregar imagem do mapa"),p("")},onLoad:()=>{console.log("âœ… Imagem do mapa carregada com sucesso no Dashboard TV")}}),j.length>0&&f.length>0&&e.jsx("div",{className:"absolute inset-0 pointer-events-none",children:j.map(a=>{const r=f.find(u=>u.id===a.equipamento_id);if(!r)return null;const o=a.color||A(r.status),t=a.fontSize||14,s=a.icon||"ri-tools-fill",n=t*4;return e.jsx("div",{className:"absolute",style:{left:`${a.x}%`,top:`${a.y}%`,width:`${a.width}%`,height:`${a.height}%`,transform:"translate(-50%, -50%)"},children:e.jsxs("div",{className:"rounded-full flex flex-col items-center justify-center shadow-lg",style:{backgroundColor:o,width:`${n}px`,height:`${n}px`},children:[e.jsx("i",{className:`${s} text-white mb-1`,style:{fontSize:`${t+4}px`}}),e.jsxs("span",{className:"text-white font-bold",style:{fontSize:`${t-2}px`},children:[r.progresso,"%"]})]})},a.id)})})]}):e.jsx("div",{className:"flex items-center justify-center h-[400px] lg:h-[500px] bg-slate-800/50 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsx("i",{className:"ri-map-pin-line text-5xl text-gray-500 mb-3"}),e.jsx("p",{className:"text-gray-400 text-sm font-medium",children:"Nenhum mapa disponÃ­vel"}),e.jsx("p",{className:"text-gray-500 text-xs mt-2",children:'FaÃ§a upload do mapa em "Mapa Industrial"'}),e.jsxs("button",{onClick:()=>{console.log("ðŸ”„ Tentando recarregar mapa...");const a=localStorage.getItem("map_image");a?(console.log("âœ… Mapa encontrado! Carregando..."),p(a)):(console.log("âŒ Ainda nÃ£o hÃ¡ mapa no localStorage"),alert('Nenhum mapa encontrado. Por favor, faÃ§a upload em "Mapa Industrial"'))},className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors cursor-pointer text-sm",children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Tentar Recarregar"]})]})})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-lg rounded-xl p-4 border border-white/20",children:[e.jsxs("h3",{className:"text-lg font-bold text-white mb-3 flex items-center gap-2",children:[e.jsx("i",{className:"ri-calendar-line text-blue-400"}),"Planejamento Semanal"]}),e.jsx("div",{className:"space-y-3 max-h-[400px] lg:max-h-[500px] overflow-y-auto pr-2",children:O.map((a,r)=>{const o=y.filter(t=>new Date(t.data_inicio).getDay()===r+1);return e.jsxs("div",{className:"bg-white/5 rounded-lg p-3 border border-white/10",children:[e.jsxs("h4",{className:"text-sm font-bold text-white mb-2 flex items-center gap-2",children:[e.jsx("i",{className:"ri-calendar-check-line text-blue-400"}),a,e.jsxs("span",{className:"ml-auto text-xs bg-blue-500/30 px-2 py-1 rounded-full",children:[o.length," atividades"]})]}),o.length>0?e.jsxs("div",{className:"space-y-2",children:[o.slice(0,3).map(t=>e.jsxs("div",{className:"bg-white/5 rounded p-2 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("i",{className:`${z(t.tipo)} text-blue-400 text-sm`}),e.jsx("span",{className:"text-xs text-white font-medium truncate flex-1",children:t.equipamento_nome}),e.jsx("span",{className:`px-2 py-0.5 rounded text-xs ${$(t.prioridade)} text-white`,children:t.prioridade})]}),e.jsx("p",{className:"text-xs text-blue-200 truncate ml-5",children:t.descricao})]},t.id)),o.length>3&&e.jsxs("p",{className:"text-xs text-gray-400 text-center",children:["+",o.length-3," atividades"]})]}):e.jsx("p",{className:"text-xs text-gray-400 ml-5",children:"Sem atividades planejadas"})]},a)})})]})]})]})}export{B as default};
//# sourceMappingURL=page-iR_o2JUQ.js.map
