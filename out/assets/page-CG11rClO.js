import{r as n,s as c,j as e}from"./index-FRp6wVcD.js";import{S as R,T as B}from"./TopBar-DS7MBlT5.js";function G(){var w;const[h,_]=n.useState(!0),[r,q]=n.useState(!0),[S,p]=n.useState(!0),[b,$]=n.useState([]),[v,E]=n.useState([]),[k,C]=n.useState([]),[l,f]=n.useState(0),[D,u]=n.useState(!1),[j,A]=n.useState(1),[i,m]=n.useState({equipamento_id:"",servico_id:"",equipe_id:"",observacoes:""}),y=[{numero:1,nome:"Segunda-feira",abrev:"SEG"},{numero:2,nome:"TerÃ§a-feira",abrev:"TER"},{numero:3,nome:"Quarta-feira",abrev:"QUA"},{numero:4,nome:"Quinta-feira",abrev:"QUI"},{numero:5,nome:"Sexta-feira",abrev:"SEX"},{numero:6,nome:"SÃ¡bado",abrev:"SÃB"}];n.useEffect(()=>{r?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[r]),n.useEffect(()=>{O()},[l]);const O=async()=>{await Promise.all([P(),T(),x()])},P=async()=>{try{const{data:a,error:s}=await c.from("equipamentos").select(`
          id,
          nome,
          equipamento_servicos (
            id,
            nome,
            percentual_revisao,
            ordem
          )
        `).order("nome");!s&&a&&E(a.map(t=>({id:t.id,nome:t.nome,servicos:(t.equipamento_servicos||[]).sort((o,g)=>o.ordem-g.ordem).map(o=>({id:o.id,nome:o.nome,percentual_revisao:o.percentual_revisao}))})))}catch(a){console.error("Erro ao carregar equipamentos:",a)}},T=async()=>{try{const{data:a,error:s}=await c.from("equipes").select("id, nome").order("nome");!s&&a&&C(a)}catch(a){console.error("Erro ao carregar equipes:",a)}},x=async()=>{try{p(!0);const{data:a,error:s}=await c.from("planejamento_semana").select(`
          *,
          equipamentos (nome),
          equipamento_servicos (nome),
          equipes (nome)
        `).eq("semana",l).order("dia_semana",{ascending:!0});!s&&a&&$(a.map(t=>{var o,g,N;return{id:t.id,equipamento_id:t.equipamento_id,equipamento_nome:((o=t.equipamentos)==null?void 0:o.nome)||"Sem equipamento",servico_id:t.servico_id,servico_nome:((g=t.equipamento_servicos)==null?void 0:g.nome)||"Sem serviÃ§o",equipe_id:t.equipe_id,equipe_nome:((N=t.equipes)==null?void 0:N.nome)||"Sem equipe",dia_semana:t.dia_semana,concluido:t.concluido||!1,observacoes:t.observacoes}}))}catch(a){console.error("Erro ao carregar atividades:",a)}finally{p(!1)}},M=a=>{A(a),u(!0)},z=async a=>{a.preventDefault();try{const{error:s}=await c.from("planejamento_semana").insert([{equipamento_id:i.equipamento_id,servico_id:i.servico_id,equipe_id:i.equipe_id,dia_semana:j,semana:l,status:"planejado",concluido:!1,observacoes:i.observacoes,created_at:new Date().toISOString()}]);if(s)throw s;u(!1),m({equipamento_id:"",servico_id:"",equipe_id:"",observacoes:""}),x()}catch(s){console.error("Erro ao criar atividade:",s),alert("Erro ao criar atividade. Verifique os dados e tente novamente.")}},L=async(a,s)=>{try{const{error:t}=await c.from("planejamento_semana").update({concluido:!s,data_conclusao:s?null:new Date().toISOString()}).eq("id",a);if(t)throw t;x()}catch(t){console.error("Erro ao atualizar atividade:",t)}},Q=async a=>{if(confirm("Tem certeza que deseja excluir esta atividade?"))try{const{error:s}=await c.from("planejamento_semana").delete().eq("id",a);if(s)throw s;x()}catch(s){console.error("Erro ao excluir atividade:",s)}},I=a=>b.filter(s=>s.dia_semana===a),d=v.find(a=>a.id===i.equipamento_id);return e.jsxs("div",{className:`min-h-screen ${r?"bg-slate-900":"bg-gray-100"} transition-colors duration-300`,children:[e.jsx(R,{isOpen:h,onToggle:()=>_(!h),darkMode:r}),e.jsxs("div",{className:`transition-all duration-300 ${h?"ml-64":"ml-20"}`,children:[e.jsx(B,{darkMode:r,setDarkMode:q}),e.jsxs("main",{className:"p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{children:[e.jsx("h1",{className:`text-3xl font-bold ${r?"text-white":"text-gray-900"}`,children:"ðŸ“… Planejamento Semanal"}),e.jsx("p",{className:`mt-1 ${r?"text-gray-400":"text-gray-600"}`,children:"Organize as atividades de manutenÃ§Ã£o da semana"})]})}),e.jsx("div",{className:`${r?"bg-slate-800":"bg-white"} rounded-xl p-6 mb-6 shadow-lg`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>f(l-1),className:`flex items-center gap-2 px-4 py-2 rounded-lg ${r?"bg-slate-700 text-white hover:bg-slate-600":"bg-gray-100 text-gray-900 hover:bg-gray-200"} transition-all cursor-pointer`,children:[e.jsx("i",{className:"ri-arrow-left-line"}),"Semana Anterior"]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("h2",{className:`text-2xl font-bold ${r?"text-white":"text-gray-900"}`,children:["Semana ",l===0?"Atual":l>0?`+${l}`:l]}),e.jsxs("p",{className:`text-sm ${r?"text-gray-400":"text-gray-600"}`,children:[b.length," atividades planejadas"]})]}),e.jsxs("button",{onClick:()=>f(l+1),className:`flex items-center gap-2 px-4 py-2 rounded-lg ${r?"bg-slate-700 text-white hover:bg-slate-600":"bg-gray-100 text-gray-900 hover:bg-gray-200"} transition-all cursor-pointer`,children:["PrÃ³xima Semana",e.jsx("i",{className:"ri-arrow-right-line"})]})]})}),S?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map(a=>{const s=I(a.numero),t=s.filter(o=>o.concluido).length;return e.jsxs("div",{className:`${r?"bg-slate-800":"bg-white"} rounded-xl shadow-lg hover:shadow-xl transition-all overflow-hidden`,children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-white font-bold text-lg",children:a.nome}),e.jsxs("p",{className:"text-blue-100 text-sm",children:[s.length," atividade",s.length!==1?"s":""]})]}),e.jsx("button",{onClick:()=>M(a.numero),className:"w-10 h-10 bg-white/20 hover:bg-white/30 rounded-lg flex items-center justify-center transition-all cursor-pointer",children:e.jsx("i",{className:"ri-add-line text-white text-2xl"})})]}),s.length>0&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-blue-100 mb-1",children:[e.jsx("span",{children:"Progresso"}),e.jsxs("span",{children:[Math.round(t/s.length*100),"%"]})]}),e.jsx("div",{className:"w-full bg-white/20 rounded-full h-2",children:e.jsx("div",{className:"bg-white rounded-full h-2 transition-all",style:{width:`${t/s.length*100}%`}})})]})]}),e.jsx("div",{className:"p-4 space-y-3 max-h-96 overflow-y-auto",children:s.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("i",{className:`ri-calendar-line text-4xl mb-2 ${r?"text-gray-600":"text-gray-300"}`}),e.jsx("p",{className:`text-sm ${r?"text-gray-500":"text-gray-400"}`,children:"Nenhuma atividade planejada"})]}):s.map(o=>e.jsx("div",{className:`p-3 rounded-lg border ${o.concluido?r?"bg-green-500/10 border-green-500/30":"bg-green-50 border-green-200":r?"bg-slate-700 border-slate-600":"bg-gray-50 border-gray-200"}`,children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("button",{onClick:()=>L(o.id,o.concluido),className:`mt-1 w-5 h-5 rounded border-2 flex items-center justify-center transition-all cursor-pointer ${o.concluido?"bg-green-500 border-green-500":r?"border-gray-500 hover:border-green-500":"border-gray-300 hover:border-green-500"}`,children:o.concluido&&e.jsx("i",{className:"ri-check-line text-white text-xs"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:`font-semibold text-sm mb-1 ${o.concluido?r?"text-green-400 line-through":"text-green-600 line-through":r?"text-white":"text-gray-900"}`,children:o.equipamento_nome}),e.jsxs("p",{className:`text-xs mb-1 ${r?"text-gray-400":"text-gray-600"}`,children:["ðŸ”§ ",o.servico_nome]}),e.jsxs("p",{className:"text-xs text-gray-500",children:["ðŸ‘¥ ",o.equipe_nome]})]}),e.jsx("button",{onClick:()=>Q(o.id),className:"p-1 rounded hover:bg-red-500/20 transition-all cursor-pointer",children:e.jsx("i",{className:"ri-delete-bin-line text-red-400 text-sm"})})]})},o.id))})]},a.numero)})})]})]}),D&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:`${r?"bg-slate-800":"bg-white"} rounded-xl p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("h2",{className:`text-2xl font-bold ${r?"text-white":"text-gray-900"}`,children:["Nova Atividade - ",(w=y.find(a=>a.numero===j))==null?void 0:w.nome]}),e.jsx("button",{onClick:()=>u(!1),className:`p-2 rounded-lg ${r?"hover:bg-slate-700":"hover:bg-gray-100"} transition-all cursor-pointer`,children:e.jsx("i",{className:`ri-close-line text-2xl ${r?"text-gray-400":"text-gray-600"}`})})]}),e.jsxs("form",{onSubmit:z,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${r?"text-gray-300":"text-gray-700"}`,children:"Equipamento"}),e.jsxs("select",{value:i.equipamento_id,onChange:a=>m({...i,equipamento_id:a.target.value,servico_id:""}),className:`w-full px-4 py-3 rounded-lg border ${r?"bg-slate-700 border-slate-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:ring-2 focus:ring-blue-500 outline-none pr-8`,required:!0,children:[e.jsx("option",{value:"",children:"Selecione um equipamento"}),v.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]}),d&&d.servicos&&d.servicos.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${r?"text-gray-300":"text-gray-700"}`,children:"ServiÃ§o"}),e.jsxs("select",{value:i.servico_id,onChange:a=>m({...i,servico_id:a.target.value}),className:`w-full px-4 py-3 rounded-lg border ${r?"bg-slate-700 border-slate-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:ring-2 focus:ring-blue-500 outline-none pr-8`,required:!0,children:[e.jsx("option",{value:"",children:"Selecione um serviÃ§o"}),d.servicos.map(a=>e.jsxs("option",{value:a.id,children:[a.nome," (",a.percentual_revisao,"% da revisÃ£o)"]},a.id))]})]}),d&&(!d.servicos||d.servicos.length===0)&&e.jsx("div",{className:`p-4 rounded-lg ${r?"bg-yellow-500/10 border border-yellow-500/30":"bg-yellow-50 border border-yellow-200"}`,children:e.jsx("p",{className:`text-sm ${r?"text-yellow-400":"text-yellow-700"}`,children:"âš ï¸ Este equipamento nÃ£o possui serviÃ§os cadastrados. Cadastre os serviÃ§os na pÃ¡gina de Equipamentos primeiro."})}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${r?"text-gray-300":"text-gray-700"}`,children:"Equipe ResponsÃ¡vel"}),e.jsxs("select",{value:i.equipe_id,onChange:a=>m({...i,equipe_id:a.target.value}),className:`w-full px-4 py-3 rounded-lg border ${r?"bg-slate-700 border-slate-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:ring-2 focus:ring-blue-500 outline-none pr-8`,required:!0,children:[e.jsx("option",{value:"",children:"Selecione uma equipe"}),k.map(a=>e.jsx("option",{value:a.id,children:a.nome},a.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:`block text-sm font-medium mb-2 ${r?"text-gray-300":"text-gray-700"}`,children:"ObservaÃ§Ãµes (opcional)"}),e.jsx("textarea",{value:i.observacoes,onChange:a=>m({...i,observacoes:a.target.value}),className:`w-full px-4 py-3 rounded-lg border ${r?"bg-slate-700 border-slate-600 text-white":"bg-white border-gray-300 text-gray-900"} focus:ring-2 focus:ring-blue-500 outline-none`,rows:3,maxLength:500})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>u(!1),className:`flex-1 px-6 py-3 rounded-lg border ${r?"border-slate-600 text-gray-300 hover:bg-slate-700":"border-gray-300 text-gray-700 hover:bg-gray-50"} transition-all whitespace-nowrap cursor-pointer`,children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:!i.equipamento_id||!i.servico_id||!i.equipe_id,className:"flex-1 bg-gradient-to-r from-blue-600 to-purple-600 text-white px-6 py-3 rounded-lg hover:shadow-lg hover:shadow-purple-500/50 transition-all whitespace-nowrap cursor-pointer disabled:opacity-50 disabled:cursor-not-allowed",children:"Adicionar Atividade"})]})]})]})})]})}export{G as default};
//# sourceMappingURL=page-CG11rClO.js.map
