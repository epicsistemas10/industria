import{s as d,a as T,r as u,j as e}from"./index-FRp6wVcD.js";import{u as E}from"./useToast-BdbpoN4k.js";class D{generateSecret(){const s="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";let a="";for(let t=0;t<32;t++)a+=s[Math.floor(Math.random()*s.length)];return a}generateBackupCodes(s=10){const a=[];for(let t=0;t<s;t++){const r=Math.random().toString(36).substring(2,10).toUpperCase();a.push(r)}return a}generateQRCodeUrl(s,a){const t="Sistema de Manutenção",r=`${t}:${a}`,i=`otpauth://totp/${encodeURIComponent(r)}?secret=${s}&issuer=${encodeURIComponent(t)}`;return`https://api.qrserver.com/v1/create-qr-code/?size=300x300&data=${encodeURIComponent(i)}`}async setupTwoFactor(s,a){const t=this.generateSecret(),r=this.generateBackupCodes(),i=this.generateQRCodeUrl(t,a);return await d.from("two_factor_auth").upsert({user_id:s,secret:t,backup_codes:r,enabled:!1,created_at:new Date().toISOString()}),{secret:t,qrCode:i,backupCodes:r}}verifyTOTP(s,a){const r=Math.floor(Date.now()/1e3),i=Math.floor(r/30);for(let l=-1;l<=1;l++){const x=i+l;if(this.generateTOTP(s,x)===a)return!0}return!1}generateTOTP(s,a){const t=this.hmacSHA1(s,a.toString()),r=t.charCodeAt(t.length-1)&15;return(((t.charCodeAt(r)&127)<<24|(t.charCodeAt(r+1)&255)<<16|(t.charCodeAt(r+2)&255)<<8|t.charCodeAt(r+3)&255)%1e6).toString().padStart(6,"0")}hmacSHA1(s,a){return btoa(s+a)}async enableTwoFactor(s,a){const{data:t,error:r}=await d.from("two_factor_auth").select("secret").eq("user_id",s).single();if(r||!t)throw new Error("Configuração 2FA não encontrada");return this.verifyTOTP(t.secret,a)?(await d.from("two_factor_auth").update({enabled:!0}).eq("user_id",s),!0):!1}async disableTwoFactor(s,a){const{data:t,error:r}=await d.from("two_factor_auth").select("secret, enabled").eq("user_id",s).single();if(r||!t||!t.enabled)throw new Error("2FA não está ativado");return this.verifyTOTP(t.secret,a)?(await d.from("two_factor_auth").delete().eq("user_id",s),!0):!1}async verifyLoginCode(s,a){const{data:t,error:r}=await d.from("two_factor_auth").select("secret, backup_codes, enabled").eq("user_id",s).single();if(r||!t||!t.enabled)return!1;if(this.verifyTOTP(t.secret,a))return!0;if(t.backup_codes&&t.backup_codes.includes(a)){const i=t.backup_codes.filter(l=>l!==a);return await d.from("two_factor_auth").update({backup_codes:i}).eq("user_id",s),!0}return!1}async isTwoFactorEnabled(s){const{data:a,error:t}=await d.from("two_factor_auth").select("enabled").eq("user_id",s).single();return!t&&(a==null?void 0:a.enabled)===!0}async regenerateBackupCodes(s,a){const{data:t,error:r}=await d.from("two_factor_auth").select("secret, enabled").eq("user_id",s).single();if(r||!t||!t.enabled)throw new Error("2FA não está ativado");if(!this.verifyTOTP(t.secret,a))throw new Error("Código inválido");const l=this.generateBackupCodes();return await d.from("two_factor_auth").update({backup_codes:l}).eq("user_id",s),l}}const b=new D;function R(){const{user:c}=T(),{success:s,error:a}=E(),[t,r]=u.useState(!1),[i,l]=u.useState(!1),[x,m]=u.useState(!1),[p,N]=u.useState(""),[C,y]=u.useState(""),[f,w]=u.useState([]),[n,h]=u.useState(""),[j,g]=u.useState(!1),k=async()=>{if(c){r(!0);try{const o=await b.setupTwoFactor(c.id,c.email||"");N(o.qrCode),y(o.secret),w(o.backupCodes),m(!0),s("Configuração 2FA iniciada!")}catch(o){a("Erro ao configurar 2FA"),console.error(o)}finally{r(!1)}}},A=async()=>{if(!(!c||!n)){r(!0);try{await b.enableTwoFactor(c.id,n)?(l(!0),m(!1),g(!0),s("Autenticação 2FA ativada com sucesso!")):a("Código de verificação inválido")}catch(o){a("Erro ao ativar 2FA"),console.error(o)}finally{r(!1),h("")}}},_=async()=>{if(!(!c||!n)){r(!0);try{await b.disableTwoFactor(c.id,n)?(l(!1),s("Autenticação 2FA desativada")):a("Código de verificação inválido")}catch(o){a("Erro ao desativar 2FA"),console.error(o)}finally{r(!1),h("")}}},F=async()=>{if(!(!c||!n)){r(!0);try{const o=await b.regenerateBackupCodes(c.id,n);w(o),g(!0),s("Códigos de backup regenerados!")}catch(o){a("Erro ao regenerar códigos"),console.error(o)}finally{r(!1),h("")}}},S=()=>{navigator.clipboard.writeText(f.join(`
`)),s("Códigos copiados para a área de transferência!")};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 p-8",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-4xl font-bold text-white mb-2",children:[e.jsx("i",{className:"ri-shield-check-line mr-3"}),"Configurações de Segurança"]}),e.jsx("p",{className:"text-slate-400",children:"Proteja sua conta com autenticação de dois fatores"})]}),e.jsx("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700/50 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-16 h-16 rounded-xl flex items-center justify-center ${i?"bg-gradient-to-br from-green-500 to-emerald-500":"bg-gradient-to-br from-slate-600 to-slate-700"}`,children:e.jsx("i",{className:`${i?"ri-shield-check-fill":"ri-shield-line"} text-3xl text-white`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-1",children:"Autenticação de Dois Fatores (2FA)"}),e.jsx("p",{className:"text-slate-400",children:i?"✅ Ativada - Sua conta está protegida":"⚠️ Desativada - Recomendamos ativar para maior segurança"})]})]}),e.jsx("button",{onClick:i?()=>m(!0):k,disabled:t,className:`px-6 py-3 rounded-lg font-semibold transition-all whitespace-nowrap ${i?"bg-red-500 hover:bg-red-600 text-white":"bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white shadow-lg"}`,children:t?e.jsx("i",{className:"ri-loader-4-line animate-spin"}):i?e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-close-circle-line mr-2"}),"Desativar 2FA"]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-shield-check-line mr-2"}),"Ativar 2FA"]})})]})}),x&&!i&&e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700/50 mb-6",children:[e.jsxs("h3",{className:"text-2xl font-bold text-white mb-6",children:[e.jsx("i",{className:"ri-qr-code-line mr-2"}),"Configurar Autenticação 2FA"]}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-start gap-3 mb-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold flex-shrink-0",children:"1"}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-2",children:"Escaneie o QR Code"}),e.jsx("p",{className:"text-slate-400 mb-4",children:"Use um aplicativo autenticador como Google Authenticator, Authy ou Microsoft Authenticator"}),p&&e.jsx("div",{className:"bg-white p-4 rounded-lg inline-block",children:e.jsx("img",{src:p,alt:"QR Code 2FA",className:"w-64 h-64"})})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold flex-shrink-0",children:"2"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-2",children:"Ou insira o código manualmente"}),e.jsx("div",{className:"bg-slate-900 p-4 rounded-lg border border-slate-700",children:e.jsx("code",{className:"text-green-400 text-lg font-mono",children:C})})]})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold flex-shrink-0",children:"3"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h4",{className:"text-lg font-semibold text-white mb-2",children:"Digite o código de verificação"}),e.jsx("input",{type:"text",value:n,onChange:o=>h(o.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-lg text-white text-center text-2xl font-mono tracking-widest focus:outline-none focus:border-blue-500",maxLength:6})]})]})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>m(!1),className:"flex-1 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold transition-all whitespace-nowrap",children:"Cancelar"}),e.jsx("button",{onClick:A,disabled:t||n.length!==6,className:"flex-1 px-6 py-3 bg-gradient-to-r from-green-500 to-emerald-500 hover:from-green-600 hover:to-emerald-600 text-white rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",children:t?e.jsx("i",{className:"ri-loader-4-line animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-check-line mr-2"}),"Ativar 2FA"]})})]})]}),x&&i&&e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-red-500/50 mb-6",children:[e.jsxs("h3",{className:"text-2xl font-bold text-white mb-4",children:[e.jsx("i",{className:"ri-error-warning-line mr-2 text-red-400"}),"Desativar Autenticação 2FA"]}),e.jsx("p",{className:"text-slate-400 mb-6",children:"⚠️ Desativar a autenticação de dois fatores tornará sua conta menos segura. Digite o código do seu aplicativo autenticador para confirmar."}),e.jsx("input",{type:"text",value:n,onChange:o=>h(o.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-lg text-white text-center text-2xl font-mono tracking-widest focus:outline-none focus:border-red-500 mb-6",maxLength:6}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>m(!1),className:"flex-1 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold transition-all whitespace-nowrap",children:"Cancelar"}),e.jsx("button",{onClick:_,disabled:t||n.length!==6,className:"flex-1 px-6 py-3 bg-gradient-to-r from-red-500 to-pink-500 hover:from-red-600 hover:to-pink-600 text-white rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",children:t?e.jsx("i",{className:"ri-loader-4-line animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-close-circle-line mr-2"}),"Confirmar Desativação"]})})]})]}),j&&f.length>0&&e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-yellow-500/50 mb-6",children:[e.jsxs("h3",{className:"text-2xl font-bold text-white mb-4",children:[e.jsx("i",{className:"ri-key-2-line mr-2 text-yellow-400"}),"Códigos de Backup"]}),e.jsx("p",{className:"text-slate-400 mb-6",children:"⚠️ Guarde estes códigos em um local seguro. Cada código pode ser usado apenas uma vez caso você perca acesso ao seu aplicativo autenticador."}),e.jsx("div",{className:"bg-slate-900 p-6 rounded-lg border border-slate-700 mb-6",children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:f.map((o,v)=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-slate-500 font-mono",children:[v+1,"."]}),e.jsx("code",{className:"text-green-400 font-mono text-lg",children:o})]},v))})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:S,className:"flex-1 px-6 py-3 bg-slate-700 hover:bg-slate-600 text-white rounded-lg font-semibold transition-all whitespace-nowrap",children:[e.jsx("i",{className:"ri-file-copy-line mr-2"}),"Copiar Códigos"]}),e.jsxs("button",{onClick:()=>g(!1),className:"flex-1 px-6 py-3 bg-gradient-to-r from-blue-500 to-cyan-500 hover:from-blue-600 hover:to-cyan-600 text-white rounded-lg font-semibold transition-all whitespace-nowrap",children:[e.jsx("i",{className:"ri-check-line mr-2"}),"Entendi, Guardei os Códigos"]})]})]}),i&&!j&&e.jsxs("div",{className:"bg-slate-800/50 backdrop-blur-sm rounded-2xl p-6 border border-slate-700/50",children:[e.jsxs("h3",{className:"text-xl font-bold text-white mb-4",children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Regenerar Códigos de Backup"]}),e.jsx("p",{className:"text-slate-400 mb-6",children:"Se você perdeu seus códigos de backup ou já usou todos, pode gerar novos códigos. Os códigos antigos serão invalidados."}),e.jsx("input",{type:"text",value:n,onChange:o=>h(o.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"Digite o código do app autenticador",className:"w-full px-4 py-3 bg-slate-900 border border-slate-700 rounded-lg text-white text-center text-lg font-mono tracking-widest focus:outline-none focus:border-blue-500 mb-4",maxLength:6}),e.jsx("button",{onClick:F,disabled:t||n.length!==6,className:"w-full px-6 py-3 bg-gradient-to-r from-yellow-500 to-orange-500 hover:from-yellow-600 hover:to-orange-600 text-white rounded-lg font-semibold transition-all disabled:opacity-50 disabled:cursor-not-allowed whitespace-nowrap",children:t?e.jsx("i",{className:"ri-loader-4-line animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx("i",{className:"ri-refresh-line mr-2"}),"Regenerar Códigos"]})})]}),e.jsxs("div",{className:"mt-8 bg-blue-500/10 border border-blue-500/30 rounded-2xl p-6",children:[e.jsxs("h3",{className:"text-lg font-bold text-blue-400 mb-3",children:[e.jsx("i",{className:"ri-information-line mr-2"}),"Dicas de Segurança"]}),e.jsxs("ul",{className:"space-y-2 text-slate-300",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("i",{className:"ri-checkbox-circle-fill text-blue-400 mt-1"}),e.jsx("span",{children:"Use um aplicativo autenticador confiável como Google Authenticator ou Authy"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("i",{className:"ri-checkbox-circle-fill text-blue-400 mt-1"}),e.jsx("span",{children:"Guarde seus códigos de backup em um local seguro e offline"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("i",{className:"ri-checkbox-circle-fill text-blue-400 mt-1"}),e.jsx("span",{children:"Nunca compartilhe seus códigos de verificação com ninguém"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("i",{className:"ri-checkbox-circle-fill text-blue-400 mt-1"}),e.jsx("span",{children:"Mantenha seu dispositivo móvel seguro com senha ou biometria"})]})]})]})]})})}export{R as default};
//# sourceMappingURL=page-BvFSIa9p.js.map
