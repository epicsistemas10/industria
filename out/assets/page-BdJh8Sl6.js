import{r,j as e}from"./index-FRp6wVcD.js";import{S as Z,T as ee}from"./TopBar-DS7MBlT5.js";import{b as g,e as te,c as ae}from"./api-DesrtcF2.js";import{u as se}from"./usePermissions-YeN8SHyT.js";function ie(){const[h,R]=r.useState(!0),[c,F]=r.useState(!0),[O,L]=r.useState([]),[T,C]=r.useState(!0),[d,M]=r.useState(""),[b,$]=r.useState(""),[f,B]=r.useState(""),[j,I]=r.useState(""),[V,x]=r.useState(!1),[m,u]=r.useState(null),{canCreate:z,canEdit:v,canDelete:y}=se(),[a,n]=r.useState({equipamento_id:"",componente_id:"",quantidade:1,valor_unitario:0,fornecedor:"",numero_nota:"",tipo_custo:"ManutenÃ§Ã£o",categoria_investimento:"OPEX",justificativa:"",data:new Date().toISOString().split("T")[0],responsavel:""}),[G,Q]=r.useState([]),[U,J]=r.useState([]);r.useEffect(()=>{c?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")},[c]),r.useEffect(()=>{N()},[]);const N=async()=>{try{C(!0);const[t,s,o]=await Promise.all([g.getAll(),te.getAll(),ae.getAll()]);L(t||[]),Q(s||[]),J(o||[])}catch(t){console.error("Erro ao carregar dados:",t)}finally{C(!1)}},W=async t=>{t.preventDefault();try{let s=a.categoria_investimento,o=a.justificativa;a.tipo_custo==="PeÃ§as"&&a.valor_unitario*a.quantidade>5e3?(s="CAPEX",o=o||"Investimento em peÃ§as de alto valor (>R$ 5.000)"):a.tipo_custo==="ManutenÃ§Ã£o"||a.tipo_custo==="MÃ£o de Obra"?(s="OPEX",o=o||"Despesa operacional recorrente"):a.tipo_custo==="ServiÃ§os"&&a.valor_unitario*a.quantidade>1e4&&(s="CAPEX",o=o||"Investimento em serviÃ§os de alto valor (>R$ 10.000)");const p={...a,categoria_investimento:s,justificativa:o,valor_total:a.quantidade*a.valor_unitario,equipamento_id:a.equipamento_id||null,componente_id:a.componente_id||null};m?await g.update(m.id,p):await g.create(p),x(!1),u(null),w(),N()}catch(s){console.error("Erro ao salvar custo:",s),alert("Erro ao salvar custo")}},H=t=>{u(t),n({equipamento_id:t.equipamento_id||"",componente_id:t.componente_id||"",quantidade:t.quantidade,valor_unitario:t.valor_unitario,fornecedor:t.fornecedor||"",numero_nota:t.numero_nota||"",tipo_custo:t.tipo_custo,data:t.data,responsavel:t.responsavel||""}),x(!0)},K=async t=>{if(confirm("Tem certeza que deseja excluir este custo?"))try{await g.delete(t),N()}catch(s){console.error("Erro ao excluir custo:",s),alert("Erro ao excluir custo")}},w=()=>{n({equipamento_id:"",componente_id:"",quantidade:1,valor_unitario:0,fornecedor:"",numero_nota:"",tipo_custo:"ManutenÃ§Ã£o",data:new Date().toISOString().split("T")[0],responsavel:""})},l=O.filter(t=>{var k,P,q,D,X,A;const s=((k=t.fornecedor)==null?void 0:k.toLowerCase().includes(d.toLowerCase()))||((P=t.numero_nota)==null?void 0:P.toLowerCase().includes(d.toLowerCase()))||((D=(q=t.equipamentos)==null?void 0:q.nome)==null?void 0:D.toLowerCase().includes(d.toLowerCase()))||((A=(X=t.componentes)==null?void 0:X.nome)==null?void 0:A.toLowerCase().includes(d.toLowerCase())),o=!b||t.tipo_custo===b,p=!f||t.data.startsWith(f),Y=!j||t.categoria_investimento===j;return s&&o&&p&&Y}),i=l.reduce((t,s)=>t+s.valor_total,0),_=l.filter(t=>t.categoria_investimento==="CAPEX").reduce((t,s)=>t+s.valor_total,0),E=l.filter(t=>t.categoria_investimento==="OPEX").reduce((t,s)=>t+s.valor_total,0),S=["ManutenÃ§Ã£o","PeÃ§as","MÃ£o de Obra","ServiÃ§os","Outros"];return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex",children:[e.jsx(Z,{isOpen:h,onToggle:()=>R(!h),darkMode:c}),e.jsxs("div",{className:`flex-1 flex flex-col transition-all duration-300 ${h?"ml-64":"ml-20"}`,children:[e.jsx(ee,{darkMode:c,setDarkMode:F}),e.jsxs("main",{className:"flex-1 overflow-y-auto p-6 bg-gray-50",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"GestÃ£o de Custos com CAPEX/OPEX"}),e.jsx("p",{className:"text-gray-600",children:"Controle financeiro automÃ¡tico de manutenÃ§Ã£o e operaÃ§Ãµes"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-600 text-sm",children:"Total Geral"}),e.jsx("i",{className:"ri-money-dollar-circle-line text-2xl text-green-500"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["R$ ",i.toLocaleString("pt-BR",{minimumFractionDigits:2})]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-600 text-sm",children:"CAPEX"}),e.jsx("i",{className:"ri-funds-line text-2xl text-blue-500"})]}),e.jsxs("p",{className:"text-2xl font-bold text-blue-600",children:["R$ ",_.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[i>0?(_/i*100).toFixed(1):0,"% do total"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-600 text-sm",children:"OPEX"}),e.jsx("i",{className:"ri-line-chart-line text-2xl text-orange-500"})]}),e.jsxs("p",{className:"text-2xl font-bold text-orange-600",children:["R$ ",E.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[i>0?(E/i*100).toFixed(1):0,"% do total"]})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-600 text-sm",children:"Registros"}),e.jsx("i",{className:"ri-file-list-3-line text-2xl text-purple-500"})]}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:l.length})]}),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-gray-600 text-sm",children:"MÃ©dia por Registro"}),e.jsx("i",{className:"ri-bar-chart-line text-2xl text-emerald-500"})]}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900",children:["R$ ",l.length>0?(i/l.length).toLocaleString("pt-BR",{minimumFractionDigits:2}):"0,00"]})]})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm p-6 mb-6 border border-gray-100",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Buscar"}),e.jsxs("div",{className:"relative",children:[e.jsx("i",{className:"ri-search-line absolute left-3 top-1/2 -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Fornecedor, nota...",value:d,onChange:t=>M(t.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Custo"}),e.jsxs("select",{value:b,onChange:t=>$(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todos os tipos"}),S.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Categoria"}),e.jsxs("select",{value:j,onChange:t=>I(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Todas"}),e.jsx("option",{value:"CAPEX",children:"CAPEX"}),e.jsx("option",{value:"OPEX",children:"OPEX"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"MÃªs"}),e.jsx("input",{type:"month",value:f,onChange:t=>B(t.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),z&&e.jsx("div",{className:"flex items-end",children:e.jsxs("button",{onClick:()=>{u(null),w(),x(!0)},className:"w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-2 rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-200 font-medium whitespace-nowrap flex items-center justify-center gap-2",children:[e.jsx("i",{className:"ri-add-line text-xl"}),"Novo Custo"]})})]})}),e.jsx("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b border-gray-200",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Data"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Categoria"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Tipo"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Equipamento/Componente"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Fornecedor"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Nota Fiscal"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Qtd"}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Valor Unit."}),e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"Valor Total"}),(v||y)&&e.jsx("th",{className:"px-6 py-4 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider",children:"AÃ§Ãµes"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:T?e.jsx("tr",{children:e.jsxs("td",{colSpan:10,className:"px-6 py-12 text-center text-gray-500",children:[e.jsx("i",{className:"ri-loader-4-line text-3xl animate-spin"}),e.jsx("p",{className:"mt-2",children:"Carregando custos..."})]})}):l.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:10,className:"px-6 py-12 text-center text-gray-500",children:[e.jsx("i",{className:"ri-inbox-line text-5xl text-gray-300 mb-2"}),e.jsx("p",{children:"Nenhum custo encontrado"})]})}):l.map(t=>{var s,o;return e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(t.data).toLocaleDateString("pt-BR")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-3 py-1 text-xs font-bold rounded-full ${t.categoria_investimento==="CAPEX"?"bg-blue-100 text-blue-800":"bg-orange-100 text-orange-800"}`,children:t.categoria_investimento})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"px-3 py-1 text-xs font-medium rounded-full bg-purple-100 text-purple-800",children:t.tipo_custo})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:((s=t.equipamentos)==null?void 0:s.nome)||((o=t.componentes)==null?void 0:o.nome)||"-"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:t.fornecedor||"-"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:t.numero_nota||"-"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-900",children:t.quantidade}),e.jsxs("td",{className:"px-6 py-4 text-sm text-gray-900",children:["R$ ",t.valor_unitario.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsxs("td",{className:"px-6 py-4 text-sm font-semibold text-green-600",children:["R$ ",t.valor_total.toLocaleString("pt-BR",{minimumFractionDigits:2})]}),(v||y)&&e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsxs("div",{className:"flex items-center gap-2",children:[v&&e.jsx("button",{onClick:()=>H(t),className:"w-8 h-8 flex items-center justify-center text-blue-600 hover:bg-blue-50 rounded-lg transition-colors",title:"Editar",children:e.jsx("i",{className:"ri-edit-line text-lg"})}),y&&e.jsx("button",{onClick:()=>K(t.id),className:"w-8 h-8 flex items-center justify-center text-red-600 hover:bg-red-50 rounded-lg transition-colors",title:"Excluir",children:e.jsx("i",{className:"ri-delete-bin-line text-lg"})})]})})]},t.id)})})]})})})]})]}),V&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"bg-gradient-to-r from-green-500 to-emerald-600 p-6 rounded-t-2xl",children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:m?"Editar Custo":"Novo Custo"}),e.jsx("p",{className:"text-green-100 text-sm mt-1",children:"ClassificaÃ§Ã£o CAPEX/OPEX automÃ¡tica"})]}),e.jsxs("form",{onSubmit:W,className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Custo *"}),e.jsx("select",{value:a.tipo_custo,onChange:t=>n({...a,tipo_custo:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",required:!0,children:S.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Categoria de Investimento *"}),e.jsxs("select",{value:a.categoria_investimento,onChange:t=>n({...a,categoria_investimento:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"OPEX",children:"OPEX - Despesa Operacional"}),e.jsx("option",{value:"CAPEX",children:"CAPEX - Investimento de Capital"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"ðŸ’¡ SerÃ¡ classificado automaticamente baseado no valor e tipo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Data *"}),e.jsx("input",{type:"date",value:a.data,onChange:t=>n({...a,data:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Equipamento"}),e.jsxs("select",{value:a.equipamento_id,onChange:t=>n({...a,equipamento_id:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),G.map(t=>e.jsx("option",{value:t.id,children:t.nome},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Componente"}),e.jsxs("select",{value:a.componente_id,onChange:t=>n({...a,componente_id:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Selecione..."}),U.map(t=>e.jsx("option",{value:t.id,children:t.nome},t.id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantidade *"}),e.jsx("input",{type:"number",min:"1",value:a.quantidade,onChange:t=>n({...a,quantidade:parseInt(t.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Valor UnitÃ¡rio (R$) *"}),e.jsx("input",{type:"number",step:"0.01",min:"0",value:a.valor_unitario,onChange:t=>n({...a,valor_unitario:parseFloat(t.target.value)}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Fornecedor"}),e.jsx("input",{type:"text",value:a.fornecedor,onChange:t=>n({...a,fornecedor:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"NÃºmero da Nota Fiscal"}),e.jsx("input",{type:"text",value:a.numero_nota,onChange:t=>n({...a,numero_nota:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"ResponsÃ¡vel"}),e.jsx("input",{type:"text",value:a.responsavel,onChange:t=>n({...a,responsavel:t.target.value}),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Justificativa da ClassificaÃ§Ã£o"}),e.jsx("textarea",{value:a.justificativa,onChange:t=>n({...a,justificativa:t.target.value}),rows:2,placeholder:"SerÃ¡ preenchida automaticamente se deixada em branco",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-green-50 p-4 rounded-lg mb-6 border border-blue-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700",children:[e.jsx("strong",{children:"Valor Total:"})," R$ ",(a.quantidade*a.valor_unitario).toLocaleString("pt-BR",{minimumFractionDigits:2})]}),e.jsx("span",{className:`px-3 py-1 text-xs font-bold rounded-full ${a.categoria_investimento==="CAPEX"?"bg-blue-500 text-white":"bg-orange-500 text-white"}`,children:a.categoria_investimento})]}),e.jsx("p",{className:"text-xs text-gray-600",children:"â„¹ï¸ Valores acima de R$ 5.000 em peÃ§as ou R$ 10.000 em serviÃ§os sÃ£o automaticamente classificados como CAPEX"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{type:"button",onClick:()=>{x(!1),u(null),w()},className:"flex-1 px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors font-medium whitespace-nowrap",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-3 rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-200 font-medium whitespace-nowrap",children:m?"Atualizar":"Criar"})]})]})]})})]})}export{ie as default};
//# sourceMappingURL=page-BdJh8Sl6.js.map
