import{s as y,r as u,j as e}from"./index-FRp6wVcD.js";import{u as q}from"./useToast-BdbpoN4k.js";const F={calculateFailureProbability(r){let t=0;const s=Math.min(r.idade_anos/20*100,100);t+=s*.2;const o=100-r.status_revisao;t+=o*.25;const l=Math.min(r.dias_desde_ultima_revisao/365*100,100);t+=l*.2;const i=Math.min(r.numero_falhas/10*100,100);t+=i*.2;const c=r.mtbf>0?Math.max(0,100-r.mtbf/8760*100):50;return t+=c*.15,Math.min(Math.round(t),100)},estimateDaysUntilFailure(r,t){return t<20?365:t<40?180:t<60?90:t<80?30:7},identifyRiskFactors(r,t){const s=[];return r.idade_anos>15&&s.push("Equipamento com idade avan√ßada (>15 anos)"),r.status_revisao<50&&s.push("Status de revis√£o cr√≠tico (<50%)"),r.dias_desde_ultima_revisao>180&&s.push("Revis√£o atrasada (>6 meses)"),r.numero_falhas>5&&s.push("Hist√≥rico de falhas frequentes"),r.mtbf<2e3&&s.push("MTBF baixo (<2000 horas)"),r.custo_medio_manutencao>5e3&&s.push("Custos de manuten√ß√£o elevados"),t>70&&s.push("Probabilidade de falha cr√≠tica"),s},generateRecommendations(r,t){const s=[];return t>70&&(s.push("üö® URGENTE: Agendar inspe√ß√£o imediata"),s.push("Considerar substitui√ß√£o preventiva de componentes cr√≠ticos")),r.status_revisao<50&&s.push("Realizar revis√£o completa o mais breve poss√≠vel"),r.dias_desde_ultima_revisao>180&&s.push("Atualizar cronograma de manuten√ß√£o preventiva"),r.numero_falhas>5&&(s.push("Investigar causa raiz das falhas recorrentes"),s.push("Avaliar necessidade de upgrade ou substitui√ß√£o")),r.mtbf<2e3&&(s.push("Implementar monitoramento cont√≠nuo"),s.push("Aumentar frequ√™ncia de inspe√ß√µes")),r.idade_anos>15&&(s.push("Avaliar viabilidade de moderniza√ß√£o"),s.push("Preparar plano de substitui√ß√£o")),s.length===0&&(s.push("Manter cronograma regular de manuten√ß√£o"),s.push("Continuar monitoramento de performance")),s},calculateConfidence(r){return r>=20?95:r>=15?85:r>=10?75:r>=5?60:40},async predictEquipmentFailure(r){try{const{data:t,error:s}=await y.from("equipamentos").select("*, setor:setores(*)").eq("id",r).single();if(s||!t)throw s;const{data:o,error:l}=await y.from("historico_revisoes").select("*").eq("equipamento_id",r).order("data_revisao",{ascending:!1});if(l)throw l;const{data:i,error:c}=await y.from("ordens_servico").select("*").eq("equipamento_id",r).order("data_abertura",{ascending:!1});if(c)throw c;const m=new Date,j=t.ano_fabricacao?new Date(t.ano_fabricacao,0,1):new Date(m.getFullYear()-10,0,1),b=(m.getTime()-j.getTime())/(1e3*60*60*24*365),f=t.ultima_revisao?new Date(t.ultima_revisao):new Date(m.getTime()-365*24*60*60*1e3),v=Math.floor((m.getTime()-f.getTime())/(1e3*60*60*24)),w=(i==null?void 0:i.filter(p=>p.tipo==="corretiva"&&p.status==="concluida").length)||0,N=i&&i.length>0?i.reduce((p,_)=>p+(_.custo_real||0),0)/i.length:0,h={mtbf:t.mtbf||5e3,mttr:24,idade_anos:Math.round(b*10)/10,horas_operacao:Math.floor(b*8760),numero_falhas:w,custo_medio_manutencao:N,dias_desde_ultima_revisao:v,status_revisao:t.status_revisao||0},x=this.calculateFailureProbability(h),n=this.estimateDaysUntilFailure(h,x),a=this.identifyRiskFactors(h,x),g=this.generateRecommendations(h,x),d=((o==null?void 0:o.length)||0)+((i==null?void 0:i.length)||0),k=this.calculateConfidence(d);return{equipamento_id:r,equipamento_nome:t.nome,probabilidade_falha:x,dias_ate_falha:n,confianca:k,fatores_risco:a,recomendacoes:g,historico_usado:d,ultima_atualizacao:new Date}}catch(t){return console.error("Erro ao gerar previs√£o:",t),null}},async predictAllEquipments(){try{const{data:r,error:t}=await y.from("equipamentos").select("id");if(t)throw t;const s=[];for(const o of r||[]){const l=await this.predictEquipmentFailure(o.id);l&&s.push(l)}return s.sort((o,l)=>l.probabilidade_falha-o.probabilidade_falha)}catch(r){return console.error("Erro ao gerar previs√µes:",r),[]}},async getHighRiskEquipments(){return(await this.predictAllEquipments()).filter(t=>t.probabilidade_falha>=60)}};function A(){const[r,t]=u.useState([]),[s,o]=u.useState(!0),[l,i]=u.useState("todos"),[c,m]=u.useState(""),{success:j,error:b}=q();u.useEffect(()=>{f()},[]);const f=async()=>{try{o(!0);const a=await F.predictAllEquipments();t(a),j("Previs√µes atualizadas com sucesso!")}catch(a){console.error("Erro ao carregar previs√µes:",a),b("Erro ao carregar previs√µes")}finally{o(!1)}},v=a=>a>=80?"critico":a>=60?"alto":a>=40?"medio":"baixo",w=a=>a>=80?"bg-red-500":a>=60?"bg-orange-500":a>=40?"bg-yellow-500":"bg-green-500",N=a=>a>=80?"text-red-600":a>=60?"text-orange-600":a>=40?"text-yellow-600":"text-green-600",h=a=>a>=80?"bg-red-50 border-red-200":a>=60?"bg-orange-50 border-orange-200":a>=40?"bg-yellow-50 border-yellow-200":"bg-green-50 border-green-200",x=r.filter(a=>{const g=l==="todos"||v(a.probabilidade_falha)===l,d=a.equipamento_nome.toLowerCase().includes(c.toLowerCase());return g&&d}),n={total:r.length,critico:r.filter(a=>a.probabilidade_falha>=80).length,alto:r.filter(a=>a.probabilidade_falha>=60&&a.probabilidade_falha<80).length,medio:r.filter(a=>a.probabilidade_falha>=40&&a.probabilidade_falha<60).length,baixo:r.filter(a=>a.probabilidade_falha<40).length};return s?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Analisando equipamentos..."})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 p-6",children:e.jsxs("div",{className:"max-w-7xl mx-auto space-y-6",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 flex items-center justify-center bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl",children:e.jsx("i",{className:"ri-brain-line text-white text-2xl"})}),"Previs√£o de Falhas com IA"]}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mt-2",children:"An√°lise preditiva baseada em dados hist√≥ricos e machine learning"})]}),e.jsxs("button",{onClick:f,className:"px-6 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all flex items-center gap-2 whitespace-nowrap",children:[e.jsx("i",{className:"ri-refresh-line"}),"Atualizar Previs√µes"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total"}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 dark:text-white mt-1",children:n.total})]}),e.jsx("div",{className:"w-12 h-12 flex items-center justify-center bg-blue-100 dark:bg-blue-900/30 rounded-lg",children:e.jsx("i",{className:"ri-dashboard-line text-blue-600 dark:text-blue-400 text-xl"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-red-200 dark:border-red-900",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Cr√≠tico"}),e.jsx("p",{className:"text-3xl font-bold text-red-600 dark:text-red-400 mt-1",children:n.critico})]}),e.jsx("div",{className:"w-12 h-12 flex items-center justify-center bg-red-100 dark:bg-red-900/30 rounded-lg",children:e.jsx("i",{className:"ri-alarm-warning-line text-red-600 dark:text-red-400 text-xl"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-orange-200 dark:border-orange-900",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-orange-600 dark:text-orange-400",children:"Alto Risco"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600 dark:text-orange-400 mt-1",children:n.alto})]}),e.jsx("div",{className:"w-12 h-12 flex items-center justify-center bg-orange-100 dark:bg-orange-900/30 rounded-lg",children:e.jsx("i",{className:"ri-error-warning-line text-orange-600 dark:text-orange-400 text-xl"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-yellow-200 dark:border-yellow-900",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"M√©dio Risco"}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600 dark:text-yellow-400 mt-1",children:n.medio})]}),e.jsx("div",{className:"w-12 h-12 flex items-center justify-center bg-yellow-100 dark:bg-yellow-900/30 rounded-lg",children:e.jsx("i",{className:"ri-alert-line text-yellow-600 dark:text-yellow-400 text-xl"})})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-green-200 dark:border-green-900",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:"Baixo Risco"}),e.jsx("p",{className:"text-3xl font-bold text-green-600 dark:text-green-400 mt-1",children:n.baixo})]}),e.jsx("div",{className:"w-12 h-12 flex items-center justify-center bg-green-100 dark:bg-green-900/30 rounded-lg",children:e.jsx("i",{className:"ri-checkbox-circle-line text-green-600 dark:text-green-400 text-xl"})})]})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-xl p-6 border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsx("div",{className:"flex-1 min-w-[200px]",children:e.jsx("input",{type:"text",placeholder:"Buscar equipamento...",value:c,onChange:a=>m(a.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white"})}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>i("todos"),className:`px-4 py-2 rounded-lg transition-colors whitespace-nowrap ${l==="todos"?"bg-blue-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:["Todos (",n.total,")"]}),e.jsxs("button",{onClick:()=>i("critico"),className:`px-4 py-2 rounded-lg transition-colors whitespace-nowrap ${l==="critico"?"bg-red-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:["Cr√≠tico (",n.critico,")"]}),e.jsxs("button",{onClick:()=>i("alto"),className:`px-4 py-2 rounded-lg transition-colors whitespace-nowrap ${l==="alto"?"bg-orange-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:["Alto (",n.alto,")"]}),e.jsxs("button",{onClick:()=>i("medio"),className:`px-4 py-2 rounded-lg transition-colors whitespace-nowrap ${l==="medio"?"bg-yellow-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:["M√©dio (",n.medio,")"]}),e.jsxs("button",{onClick:()=>i("baixo"),className:`px-4 py-2 rounded-lg transition-colors whitespace-nowrap ${l==="baixo"?"bg-green-500 text-white":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:["Baixo (",n.baixo,")"]})]})]})}),e.jsxs("div",{className:"space-y-4",children:[x.map(a=>e.jsxs("div",{className:`bg-white dark:bg-gray-800 rounded-xl p-6 border-2 ${h(a.probabilidade_falha)} dark:border-gray-700`,children:[e.jsxs("div",{className:"flex flex-wrap items-start justify-between gap-4 mb-4",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-2",children:a.equipamento_nome}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"ri-time-line"}),"Atualizado: ",a.ultima_atualizacao.toLocaleString("pt-BR")]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("i",{className:"ri-database-2-line"}),a.historico_usado," registros analisados"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:`text-4xl font-bold ${N(a.probabilidade_falha)}`,children:[a.probabilidade_falha,"%"]}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Probabilidade de Falha"})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:`${w(a.probabilidade_falha)} h-3 rounded-full transition-all duration-500`,style:{width:`${a.probabilidade_falha}%`}})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("i",{className:"ri-calendar-line text-gray-600 dark:text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Tempo Estimado"})]}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[a.dias_ate_falha," dias"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("i",{className:"ri-shield-check-line text-gray-600 dark:text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Confian√ßa"})]}),e.jsxs("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[a.confianca,"%"]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("i",{className:"ri-alert-line text-gray-600 dark:text-gray-400"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Fatores de Risco"})]}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:a.fatores_risco.length})]})]}),a.fatores_risco.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("i",{className:"ri-error-warning-line"}),"Fatores de Risco Identificados:"]}),e.jsx("ul",{className:"space-y-2",children:a.fatores_risco.map((g,d)=>e.jsxs("li",{className:"flex items-start gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx("i",{className:"ri-arrow-right-s-line text-red-500 mt-1"}),e.jsx("span",{children:g})]},d))})]}),a.recomendacoes.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("i",{className:"ri-lightbulb-line"}),"Recomenda√ß√µes:"]}),e.jsx("ul",{className:"space-y-2",children:a.recomendacoes.map((g,d)=>e.jsxs("li",{className:"flex items-start gap-2 text-gray-700 dark:text-gray-300",children:[e.jsx("i",{className:"ri-checkbox-circle-line text-green-500 mt-1"}),e.jsx("span",{children:g})]},d))})]})]},a.equipamento_id)),x.length===0&&e.jsxs("div",{className:"text-center py-12 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700",children:[e.jsx("i",{className:"ri-search-line text-4xl text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Nenhuma previs√£o encontrada com os filtros aplicados"})]})]})]})})}export{A as default};
//# sourceMappingURL=page-BEY3kh3F.js.map
