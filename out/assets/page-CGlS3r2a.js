import{r as a,j as e,s as U}from"./index-FRp6wVcD.js";import{S as W,T as Y}from"./TopBar-DS7MBlT5.js";import{s as h,e as G}from"./api-DesrtcF2.js";function Q(){const[r,$]=a.useState(!0),[v,_]=a.useState(!0),[n,q]=a.useState([]),[V,S]=a.useState(!0),[I,m]=a.useState(!1),[g,C]=a.useState(null),[o,d]=a.useState({codigo:"",nome:"",descricao:"",percentual_revisao:""}),f=["Preventiva","Preditiva","Corretiva","Melhoria"],[E,k]=a.useState(f[0]),[M,T]=a.useState([]),[A,j]=a.useState(!1),[u,D]=a.useState(null),[b,y]=a.useState([]);a.useEffect(()=>{N()},[]);const N=async()=>{S(!0);try{const s=await h.getAll();q(s||[]);const t=await G.getAll();T(t||[])}catch(s){console.error("Erro ao carregar serviços/equipamentos:",s)}finally{S(!1)}},P=()=>{C(null);const s=F();d({codigo:s,nome:"",descricao:"",percentual_revisao:""}),k(f[0]),m(!0)},F=()=>{try{const t=`SV-${new Date().getFullYear()}-`;let i=0;n.forEach(p=>{const x=p.codigo||"";if(x.startsWith(t)){const l=x.replace(t,""),w=parseInt(l,10);!isNaN(w)&&w>i&&(i=w)}});const c=(i+1).toString().padStart(4,"0");return`${t}${c}`}catch{return`SV-${Date.now().toString(36).toUpperCase()}`}},O=s=>{var t;C(s),d({codigo:s.codigo||"",nome:s.nome||"",descricao:s.descricao||"",percentual_revisao:((t=s.percentual_revisao)==null?void 0:t.toString())||""}),m(!0)},z=async s=>{s&&s.preventDefault();try{const t={codigo:o.codigo,nome:o.nome,descricao:o.descricao||null,tipo:E};o.percentual_revisao&&(t.percentual_revisao=parseFloat(o.percentual_revisao)),g?await h.update(g.id,t):await h.create(t),m(!1),await N()}catch(t){console.error("Erro ao salvar serviço:",t),alert("Erro ao salvar serviço")}},R=async s=>{if(confirm("Remover serviço?"))try{await h.delete(s),await N()}catch(t){console.error("Erro ao excluir serviço:",t),alert("Erro ao excluir serviço")}},B=s=>{D(s),y([]),j(!0)},L=async()=>{if(!u||b.length===0){alert("Selecione pelo menos um equipamento");return}try{const s=b.map(i=>{var c,p,x;return{equipamento_id:i,nome:((c=n.find(l=>l.id===u))==null?void 0:c.nome)||"",descricao:((p=n.find(l=>l.id===u))==null?void 0:p.descricao)||null,percentual_revisao:((x=n.find(l=>l.id===u))==null?void 0:x.percentual_revisao)||0,servico_id:u}}),{error:t}=await U.from("equipamento_servicos").insert(s);if(t)throw t;alert("Serviço vinculado aos equipamentos"),j(!1)}catch(s){console.error("Erro ao vincular serviço:",s),alert("Erro ao vincular serviço")}};return e.jsxs("div",{className:`min-h-screen ${r?"bg-slate-900":"bg-gray-100"} transition-colors duration-300`,children:[e.jsx(W,{isOpen:v,onToggle:()=>_(!v),darkMode:r}),e.jsxs("div",{className:`transition-all duration-300 ${v?"ml-64":"ml-20"}`,children:[e.jsx(Y,{darkMode:r,setDarkMode:$}),e.jsxs("main",{className:"p-6",children:[e.jsxs("div",{className:"mb-6 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:`text-3xl font-bold ${r?"text-white":"text-gray-900"}`,children:"Serviços"}),e.jsx("p",{className:`mt-1 ${r?"text-gray-400":"text-gray-600"}`,children:"Cadastre serviços padrão e vincule aos equipamentos"})]}),e.jsx("div",{children:e.jsx("button",{onClick:P,className:"px-6 py-3 bg-gradient-to-r from-blue-600 to-cyan-600 text-white rounded-lg",children:"Novo Serviço"})})]}),V?e.jsx("div",{className:"py-12 text-center text-gray-400",children:"Carregando..."}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:n.map(s=>e.jsxs("div",{className:`p-4 rounded-xl ${r?"bg-slate-800":"bg-white"} shadow`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-gray-400",children:s.codigo}),e.jsx("h3",{className:`font-semibold ${r?"text-white":"text-gray-900"}`,children:s.nome})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>B(s.id),className:"px-3 py-1 bg-emerald-600 text-white rounded",children:"Vincular"}),e.jsx("button",{onClick:()=>O(s),className:"px-3 py-1 bg-blue-600 text-white rounded",children:"Editar"}),e.jsx("button",{onClick:()=>R(s.id),className:"px-3 py-1 bg-red-600 text-white rounded",children:"Excluir"})]})]}),e.jsx("p",{className:`text-sm ${r?"text-gray-300":"text-gray-600"}`,children:s.descricao})]},s.id))}),I&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:`${r?"bg-slate-800":"bg-white"} rounded-xl w-full max-w-2xl p-6`,children:[e.jsx("h3",{className:`text-lg font-semibold ${r?"text-white":"text-gray-900"}`,children:g?"Editar Serviço":"Novo Serviço"}),e.jsxs("form",{onSubmit:z,className:"mt-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400",children:"Código do Serviço"}),e.jsx("input",{className:"w-full px-3 py-2 rounded",value:o.codigo,onChange:s=>d({...o,codigo:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400",children:"Nome"}),e.jsx("input",{className:"w-full px-3 py-2 rounded",value:o.nome,onChange:s=>d({...o,nome:s.target.value}),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400",children:"Descrição"}),e.jsx("textarea",{className:"w-full px-3 py-2 rounded",value:o.descricao,onChange:s=>d({...o,descricao:s.target.value})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400",children:"Tipo"}),e.jsx("select",{className:"w-full px-3 py-2 rounded",value:E,onChange:s=>k(s.target.value),children:f.map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"flex gap-2 justify-end",children:[e.jsx("button",{type:"button",onClick:()=>m(!1),className:"px-4 py-2",children:"Cancelar"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 text-white rounded",children:"Salvar"})]})]})]})}),A&&e.jsx("div",{className:"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:`${r?"bg-slate-800":"bg-white"} rounded-xl w-full max-w-2xl p-6`,children:[e.jsx("h3",{className:`text-lg font-semibold ${r?"text-white":"text-gray-900"}`,children:"Vincular Serviço a Equipamentos"}),e.jsx("div",{className:"mt-4 max-h-64 overflow-y-auto space-y-2",children:M.map(s=>e.jsxs("label",{className:"flex items-center gap-3 p-2 border rounded",children:[e.jsx("input",{type:"checkbox",checked:b.includes(s.id),onChange:t=>{t.target.checked?y(i=>[...i,s.id]):y(i=>i.filter(c=>c!==s.id))}}),e.jsx("div",{className:"flex-1",children:s.nome})]},s.id))}),e.jsxs("div",{className:"flex gap-2 justify-end mt-4",children:[e.jsx("button",{onClick:()=>j(!1),className:"px-4 py-2",children:"Cancelar"}),e.jsx("button",{onClick:L,className:"px-4 py-2 bg-emerald-600 text-white rounded",children:"Vincular"})]})]})})]})]})]})}export{Q as default};
//# sourceMappingURL=page-CGlS3r2a.js.map
